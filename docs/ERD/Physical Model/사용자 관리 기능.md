# 사용자 관리 기능

``` mermaid
erDiagram
    USERS {
        BIGINT id PK "PK, AUTO_INCREMENT"
        VARCHAR login_id "로그인 ID (LOCAL, NULL 가능, UNIQUE)"
        VARCHAR password_hash "비밀번호 해시 (LOCAL 전용)"
        VARCHAR name "이름"
        VARCHAR phone "전화번호"
        VARCHAR email "이메일 (UNIQUE)"
        DATE birth_date "생년월일"
        VARCHAR address "주소"
        ENUM gender "M, F, OTHER, UNKNOWN"
        VARCHAR profile_image_url "프로필 이미지 URL"
        ENUM auth_provider "LOCAL, GOOGLE"
        VARCHAR provider_id "소셜 provider 고유 ID"
        ENUM status "ACTIVE, WITHDRAWN, BANNED"
        ENUM visit_visibility_setting "PUBLIC, FRIENDS, PRIVATE"
        DATETIME last_login_at "마지막 로그인 시각"
        DATETIME created_at "생성 시각"
        DATETIME updated_at "수정 시각"
        DATETIME deleted_at "소프트 삭제 시각"
    }

    VISITS {
        BIGINT id PK "PK, AUTO_INCREMENT"
        BIGINT user_id FK "FK → USERS.id"
        BIGINT bar_id FK "FK → BARS.id"
        DATETIME visited_at "방문 시각"
        INT people_count "동석 인원 수"
        TINYINT phase "1차/2차/3차 단계"
        ENUM visibility "PUBLIC, FRIENDS, PRIVATE"
        DATETIME created_at "생성 시각"
        DATETIME updated_at "수정 시각"
        DATETIME deleted_at "소프트 삭제 시각"
    }

    USER_PREFERENCE_PROFILES {
        BIGINT id PK "PK, AUTO_INCREMENT"
        BIGINT user_id FK "FK → USERS.id, UNIQUE"
        JSON preferred_categories "선호 카테고리 리스트"
        ENUM preferred_price_level "LOW, MID, HIGH"
        JSON preferred_mood_tags "선호 분위기 태그"
        JSON disliked_tags "비선호 태그"
        JSON profile_vector "추천 벡터(임베딩 등)"
        DATETIME created_at "생성 시각"
        DATETIME updated_at "수정 시각"
        DATETIME deleted_at "소프트 삭제 시각"
    }

    BARS {
        BIGINT id PK "외부 도메인의 바 ID"
    }

    USERS ||--o{ VISITS : has
    BARS  ||--o{ VISITS : has
    USERS ||--o| USER_PREFERENCE_PROFILES : has

```



## users

| 컬럼명                      | 타입                                  | NOT NULL        | 설명                                      |
| ------------------------ | ----------------------------------- | --------------- | --------------------------------------- |
| id                       | BIGINT UNSIGNED PK                  | Y               | 회원 PK                                   |
| login_id                 | VARCHAR(50)                         | Y, UNIQUE       | 로그인용 아이디                                |
| password_hash            | VARCHAR(255)                        | Y               | 비밀번호 해시(BCrypt 등)                       |
| name                     | VARCHAR(50)                         | Y               | 이름                                      |
| phone                    | VARCHAR(20)                         | Y               | 전화번호                                    |
| email                    | VARCHAR(100)                        | Y, UNIQUE       | 이메일                                     |
| birth_date               | DATE                                | Y               | 생년월일                                    |
| address                  | VARCHAR(255)                        | Y               | 기본 주소                                   |
| gender                   | ENUM('M','F','OTHER','UNKNOWN')     | Y, 기본 'UNKNOWN' | 성별                                      |
| profile_image_url        | VARCHAR(255)                        | N               | 프로필 이미지 URL                             |
| status                   | ENUM('ACTIVE','WITHDRAWN','BANNED') | Y, 기본 'ACTIVE'  | 계정 상태                                   |
| visit_visibility_setting | ENUM('PUBLIC','FRIENDS','PRIVATE')  | Y, 기본 'PRIVATE' | **방문 이력 기본 공개 범위** (FR19 대응: 전체/친구/비공개) |
| last_login_at            | DATETIME                            | N               | 마지막 로그인 시각                              |
| created_at               | DATETIME                            | Y               | 생성 시각                                   |
| updated_at               | DATETIME                            | Y               | 수정 시각                                   |
| deleted_at               | DATETIME                            | N               | 탈퇴 시각 (soft delete용)                    |

## visits

| 컬럼명          | 타입                                 | NOT NULL | 설명                                      |
| ------------ | ---------------------------------- | -------- | --------------------------------------- |
| id           | BIGINT UNSIGNED PK                 | Y        | 방문 이력 PK                                |
| user_id      | BIGINT UNSIGNED FK                 | Y        | 방문한 유저 (USERS.id)                       |
| bar_id       | BIGINT UNSIGNED FK                 | Y        | 방문한 술집 (BARS.id)                        |
| visited_at   | DATETIME                           | Y        | 방문 시각                                   |
| people_count | INT UNSIGNED                       | N        | 함께 간 인원 수                               |
| phase        | TINYINT UNSIGNED                   | N        | 1차/2차/3차… (1,2,3…)                      |
| visibility   | ENUM('PUBLIC','FRIENDS','PRIVATE') | Y        | 이 방문 기록의 공개 범위 (FR19 – 개별 방문별 오버라이드 가능) |
| created_at   | DATETIME                           | Y        | 생성 시각                                   |
| updated_at   | DATETIME                           | Y        | 수정 시각                                   |
| deleted_at   | DATETIME                           | N        | 삭제 시각                                   |

## user_preference_profiles

|컬럼명|타입|NOT NULL|설명|
|---|---|---|---|
|id|BIGINT UNSIGNED PK|Y|프로파일 PK|
|user_id|BIGINT UNSIGNED FK|Y, UNIQUE|대상 유저 (USERS.id), 1:1 관계|
|preferred_categories|JSON|N|선호 카테고리 목록 (이자카야, 와인바 등)|
|preferred_price_level|ENUM('LOW','MID','HIGH')|N|선호 가격대 레벨|
|preferred_mood_tags|JSON|N|분위기 태그(조용한, 시끄러운, 감성, 복고 등)|
|disliked_tags|JSON|N|싫어하는 분위기/요소 태그|
|profile_vector|JSON|N|추천 모델용 feature 벡터/가중치 캐시(자유 형식)|
|created_at|DATETIME|Y|생성 시각|
|updated_at|DATETIME|Y|수정 시각|
|deleted_at|DATETIME|N|필요 시 비활성 시각|